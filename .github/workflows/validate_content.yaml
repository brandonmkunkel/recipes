name: Validate Content Files

on:
  pull_request:
    paths:
      - 'content/**'

permissions:
  contents: read

jobs:
  validate-markdown:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout your repository
        uses: actions/checkout@v4

      - name: Validate content files are markdown
        id: validate
        run: |
          non_md_files=$(find content -type f ! -name "*.md")
          if [ -z "$non_md_files" ]; then
            echo "✓ All files in content directory are markdown files"
          else
            echo "✗ Non-markdown files found in content directory:"
            echo "$non_md_files"
            echo "non_md_files<<EOF" >> $GITHUB_OUTPUT
            echo "$non_md_files" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
            exit 1
          fi

      - name: Comment on PR with validation errors
        if: failure()
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: '❌ Validation failed: Non-markdown files found in content directory.\n\n' +
                    '```\n' +
                    '${{ steps.validate.outputs.non_md_files }}\n' +
                    '```\n\n' +
                    'Please ensure all files in the `content/` directory are markdown files (`.md`).'
            })
